<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•æœ¬åœ°å­˜å‚¨æŒä¹…åŒ–</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            background: #e9ecef;
            border-radius: 3px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>CodeCA æœ¬åœ°å­˜å‚¨æŒä¹…åŒ–æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>1. æ¨¡æ‹Ÿå¡ç‰‡æ•°æ®å­˜å‚¨</h2>
        <button onclick="saveTestData()">ä¿å­˜æµ‹è¯•å¡ç‰‡æ•°æ®</button>
        <button onclick="loadTestData()">åŠ è½½å­˜å‚¨çš„æ•°æ®</button>
        <button onclick="clearTestData()">æ¸…é™¤å­˜å‚¨æ•°æ®</button>
        <div id="storage-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. æŸ¥çœ‹å½“å‰å­˜å‚¨å†…å®¹</h2>
        <button onclick="viewStorageContent()">æŸ¥çœ‹localStorageå†…å®¹</button>
        <div id="content-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>3. æµ‹è¯•Dateå¯¹è±¡åºåˆ—åŒ–</h2>
        <button onclick="testDateSerialization()">æµ‹è¯•Dateåºåˆ—åŒ–</button>
        <div id="date-result" class="result"></div>
    </div>

    <script>
        const STORAGE_KEY = 'codeca-app-storage';
        
        // æ¨¡æ‹Ÿå¡ç‰‡æ•°æ®
        const testCards = [
            {
                id: '1',
                front: 'ä»€ä¹ˆæ˜¯Reactï¼Ÿ',
                back: 'Reactæ˜¯ä¸€ä¸ªç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„JavaScriptåº“',
                type: 'basic',
                difficulty: 'medium',
                tags: ['react', 'javascript'],
                createdAt: new Date()
            },
            {
                id: '2',
                front: 'CSS Gridçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ',
                back: 'CSS Gridæ˜¯ä¸€ä¸ªäºŒç»´å¸ƒå±€ç³»ç»Ÿï¼Œç”¨äºåˆ›å»ºå¤æ‚çš„ç½‘é¡µå¸ƒå±€',
                type: 'definition',
                difficulty: 'hard',
                tags: ['css', 'layout'],
                createdAt: new Date()
            }
        ];
        
        function saveTestData() {
            const storeData = {
                state: {
                    cards: testCards,
                    bucketCards: ['1'],
                    locale: 'zh-CN',
                    selectedProvider: 'openai',
                    isBucketVisible: true
                },
                version: 1
            };
            
            // æ¨¡æ‹ŸZustand persistçš„å­˜å‚¨é€»è¾‘
            const serializedData = {
                ...storeData,
                state: {
                    ...storeData.state,
                    cards: storeData.state.cards.map(card => ({
                        ...card,
                        createdAt: card.createdAt.toISOString()
                    }))
                }
            };
            
            localStorage.setItem(STORAGE_KEY, JSON.stringify(serializedData));
            
            document.getElementById('storage-result').textContent = 
                'âœ… æµ‹è¯•æ•°æ®å·²ä¿å­˜åˆ°localStorage\n' +
                `ä¿å­˜äº† ${testCards.length} å¼ å¡ç‰‡\n` +
                `å­˜å‚¨å¤§å°: ${JSON.stringify(serializedData).length} å­—ç¬¦`;
        }
        
        function loadTestData() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (!stored) {
                document.getElementById('storage-result').textContent = 'âŒ æ²¡æœ‰æ‰¾åˆ°å­˜å‚¨çš„æ•°æ®';
                return;
            }
            
            try {
                const parsed = JSON.parse(stored);
                
                // æ¨¡æ‹Ÿååºåˆ—åŒ–Dateå¯¹è±¡
                if (parsed.state?.cards) {
                    parsed.state.cards = parsed.state.cards.map(card => ({
                        ...card,
                        createdAt: new Date(card.createdAt)
                    }));
                }
                
                document.getElementById('storage-result').textContent = 
                    'âœ… æ•°æ®åŠ è½½æˆåŠŸ\n' +
                    `å¡ç‰‡æ•°é‡: ${parsed.state.cards?.length || 0}\n` +
                    `æ¡¶ä¸­å¡ç‰‡: ${parsed.state.bucketCards?.length || 0}\n` +
                    `è¯­è¨€è®¾ç½®: ${parsed.state.locale}\n` +
                    `é€‰ä¸­çš„AI: ${parsed.state.selectedProvider}\n` +
                    `ç¬¬ä¸€å¼ å¡ç‰‡åˆ›å»ºæ—¶é—´: ${parsed.state.cards?.[0]?.createdAt}`;
                    
            } catch (error) {
                document.getElementById('storage-result').textContent = 
                    'âŒ æ•°æ®è§£æå¤±è´¥: ' + error.message;
            }
        }
        
        function clearTestData() {
            localStorage.removeItem(STORAGE_KEY);
            document.getElementById('storage-result').textContent = 'ğŸ—‘ï¸ å­˜å‚¨æ•°æ®å·²æ¸…é™¤';
        }
        
        function viewStorageContent() {
            const allKeys = Object.keys(localStorage);
            const codecaKeys = allKeys.filter(key => key.includes('codeca'));
            
            let result = `localStorageä¸­çš„æ‰€æœ‰é”® (${allKeys.length}):\n`;
            result += allKeys.join(', ') + '\n\n';
            
            result += `CodeCAç›¸å…³çš„é”® (${codecaKeys.length}):\n`;
            codecaKeys.forEach(key => {
                const value = localStorage.getItem(key);
                result += `${key}: ${value ? value.length + ' å­—ç¬¦' : 'null'}\n`;
            });
            
            if (codecaKeys.length > 0) {
                result += '\nè¯¦ç»†å†…å®¹:\n';
                codecaKeys.forEach(key => {
                    const value = localStorage.getItem(key);
                    result += `\n${key}:\n${value}\n`;
                });
            }
            
            document.getElementById('content-result').textContent = result;
        }
        
        function testDateSerialization() {
            const testDate = new Date();
            const serialized = testDate.toISOString();
            const deserialized = new Date(serialized);
            
            const result = 
                `åŸå§‹Date: ${testDate}\n` +
                `åºåˆ—åŒ–å: ${serialized}\n` +
                `ååºåˆ—åŒ–: ${deserialized}\n` +
                `æ˜¯å¦ç›¸ç­‰: ${testDate.getTime() === deserialized.getTime() ? 'âœ…' : 'âŒ'}\n` +
                `æ—¶é—´å·®: ${Math.abs(testDate.getTime() - deserialized.getTime())}ms`;
                
            document.getElementById('date-result').textContent = result;
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥å­˜å‚¨çŠ¶æ€
        window.onload = function() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                document.getElementById('storage-result').textContent = 
                    'ğŸ“¦ å‘ç°å·²å­˜å‚¨çš„æ•°æ®ï¼Œç‚¹å‡»"åŠ è½½å­˜å‚¨çš„æ•°æ®"æŸ¥çœ‹è¯¦æƒ…';
            } else {
                document.getElementById('storage-result').textContent = 
                    'ğŸ“­ æš‚æ— å­˜å‚¨æ•°æ®ï¼Œç‚¹å‡»"ä¿å­˜æµ‹è¯•å¡ç‰‡æ•°æ®"å¼€å§‹æµ‹è¯•';
            }
        };
    </script>
</body>
</html>